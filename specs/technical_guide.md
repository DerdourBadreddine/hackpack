# Technical Guide

## 1. Database Schema (Supabase/Postgres)

```sql
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- Users Table
create table users (
  id uuid primary key default uuid_generate_v4(),
  github_id text unique not null,
  username text not null,
  avatar_url text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- Projects Table
create table projects (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid references users(id) not null,
  template_id text not null,
  name text not null,
  repo_url text not null,
  deploy_url text,
  status text check (status in ('generating', 'ready', 'failed')),
  created_at timestamp with time zone default timezone('utc'::text, now())
);
```

## 2. API Implementation (Next.js API Route)

**File:** `pages/api/generate.ts`

```typescript
import { NextApiRequest, NextApiResponse } from 'next';
import { Octokit } from '@octokit/rest';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method !== 'POST') return res.status(405).end();

  const { token, templateOwner, templateRepo, name, description } = req.body;

  const octokit = new Octokit({ auth: token });

  try {
    // 1. Create Repo from Template
    const { data: repo } = await octokit.repos.createUsingTemplate({
      template_owner: templateOwner,
      template_repo: templateRepo,
      name: name,
      description: description,
      private: true, // Default to private for hackathons
      include_all_branches: false
    });

    // 2. Generate Custom README (Logic would be imported from service)
    const readmeContent = `# ${name}\n\nGenerated by Hackpack.\n\n${description}`;
    
    // 3. Commit README (Wait a bit for repo to be ready, usually needed)
    // Note: In production, use a queue or retry mechanism
    await octokit.repos.createOrUpdateFileContents({
      owner: repo.owner.login,
      repo: repo.name,
      path: 'README.md',
      message: 'docs: generate readme via Hackpack',
      content: Buffer.from(readmeContent).toString('base64'),
    });

    // 4. Return Success
    res.status(200).json({ 
      success: true, 
      repoUrl: repo.html_url, 
      cloneUrl: repo.clone_url 
    });

  } catch (error: any) {
    console.error(error);
    res.status(500).json({ error: error.message });
  }
}
```

## 3. README Generator Script

**File:** `scripts/readme-gen.js`

```javascript
const Handlebars = require('handlebars');

const templateSource = `
# {{projectName}} ðŸš€

> {{description}}

Generated by [Hackpack](https://hackpack.app) using the **{{templateName}}** template.

## Tech Stack
{{#each techStack}}
- {{this}}
{{/each}}

## Quick Start

\`\`\`bash
# Clone
git clone {{repoUrl}}

# Install
npm install

# Run
npm run dev
\`\`\`

## Deployment
This project includes a \`vercel.json\` configuration.
[Deploy to Vercel]({{deployLink}})
`;

function generateReadme(data) {
  const template = Handlebars.compile(templateSource);
  return template(data);
}

module.exports = { generateReadme };
```

## 4. CI/CD Workflow Stub

**File:** `.github/workflows/deploy.yml`

```yaml
name: Deploy
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
      - name: Build
        run: npm run build
      - name: Test
        run: npm run test
```
